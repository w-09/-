<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ”¶æ”¯ç®¡ç†ç³»çµ± - æ‰‹å‹•è¼¸å…¥ç‰ˆ</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
      body {
          font-family: 'Microsoft JhengHei', Arial, sans-serif;
          margin: 0;
          padding: 20px;
          background-color: #f5f7fa;
      }
      .container {
          max-width: 1600px;
          margin: 0 auto;
      }
      .header {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: white;
          padding: 30px;
          border-radius: 15px;
          text-align: center;
          margin-bottom: 30px;
          box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      }
      .header h1 {
          margin: 0 0 10px 0;
          font-size: 2.5em;
          font-weight: 300;
      }
      .quick-guide {
          background: #e8f5e9;
          border-left: 4px solid #4caf50;
          padding: 20px;
          margin: 20px 0;
          border-radius: 0 10px 10px 0;
      }
      .quick-guide h3 {
          color: #2e7d32;
          margin-top: 0;
      }
      .quick-guide ol {
          margin: 10px 0;
          padding-left: 20px;
      }
      .quick-guide li {
          margin: 8px 0;
      }
      .data-source-links {
          background: #f3e5f5;
          padding: 15px;
          border-radius: 10px;
          margin: 20px 0;
          text-align: center;
      }
      .data-source-links a {
          display: inline-block;
          margin: 5px 10px;
          padding: 10px 20px;
          background: #9c27b0;
          color: white;
          text-decoration: none;
          border-radius: 25px;
          transition: all 0.3s ease;
      }
      .data-source-links a:hover {
          background: #7b1fa2;
          transform: translateY(-2px);
      }
      .stats-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
          gap: 20px;
          margin-bottom: 30px;
      }
      .stat-card {
          background: white;
          padding: 25px;
          border-radius: 15px;
          box-shadow: 0 4px 20px rgba(0,0,0,0.1);
          text-align: center;
          position: relative;
          overflow: hidden;
      }
      .stat-card::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          height: 4px;
          background: linear-gradient(135deg, #667eea, #764ba2);
      }
      .stat-card.income::before {
          background: linear-gradient(135deg, #28a745, #20c997);
      }
      .stat-card.expense::before {
          background: linear-gradient(135deg, #dc3545, #fd7e14);
      }
      .stat-card.balance::before {
          background: linear-gradient(135deg, #17a2b8, #20c997);
      }
      .stat-card h3 {
          font-size: 2.2em;
          margin: 0 0 10px 0;
          font-weight: 300;
          color: #2c3e50;
      }
      .stat-card p {
          margin: 0;
          color: #6c757d;
          font-weight: 500;
      }
      .input-section {
          background: white;
          padding: 30px;
          border-radius: 15px;
          margin-bottom: 30px;
          box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      }
      .input-section h2 {
          color: #2c3e50;
          margin-bottom: 20px;
          display: flex;
          align-items: center;
          gap: 10px;
      }
      .form-group {
          margin-bottom: 20px;
      }
      .form-group label {
          display: block;
          font-weight: 600;
          color: #495057;
          margin-bottom: 8px;
      }
      .form-group input,
      .form-group select,
      .form-group textarea {
          width: 100%;
          padding: 12px;
          border: 1px solid #ddd;
          border-radius: 8px;
          font-size: 14px;
          transition: border-color 0.3s ease;
      }
      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
          outline: none;
          border-color: #667eea;
      }
      .form-group textarea {
          min-height: 100px;
          resize: vertical;
      }
      .form-row {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
          gap: 20px;
      }
      .btn {
          padding: 12px 24px;
          border: none;
          border-radius: 8px;
          cursor: pointer;
          font-weight: 500;
          transition: all 0.3s ease;
          font-size: 14px;
      }
      .btn-primary {
          background: linear-gradient(135deg, #667eea, #764ba2);
          color: white;
      }
      .btn-primary:hover {
          transform: translateY(-2px);
          box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }
      .btn-success {
          background: linear-gradient(135deg, #28a745, #20c997);
          color: white;
      }
      .btn-danger {
          background: linear-gradient(135deg, #dc3545, #c82333);
          color: white;
      }
      .btn-secondary {
          background: #6c757d;
          color: white;
      }
      .btn-group {
          display: flex;
          gap: 10px;
          margin-top: 20px;
      }
      .data-table {
          background: white;
          border-radius: 15px;
          overflow: hidden;
          box-shadow: 0 4px 20px rgba(0,0,0,0.1);
          margin-bottom: 30px;
      }
      .table-header {
          background: linear-gradient(135deg, #f8f9fa, #e9ecef);
          padding: 20px;
          display: flex;
          justify-content: space-between;
          align-items: center;
      }
      .table-header h3 {
          margin: 0;
          color: #2c3e50;
      }
      .table-wrapper {
          overflow-x: auto;
          max-height: 500px;
          overflow-y: auto;
      }
      table {
          width: 100%;
          border-collapse: collapse;
      }
      th, td {
          padding: 15px;
          text-align: left;
          border-bottom: 1px solid #e9ecef;
      }
      th {
          background: #f8f9fa;
          font-weight: 600;
          color: #495057;
          position: sticky;
          top: 0;
          z-index: 10;
      }
      tr:hover {
          background: #f8f9fa;
      }
      .amount {
          font-weight: 600;
          text-align: right;
      }
      .amount.positive {
          color: #28a745;
      }
      .amount.negative {
          color: #dc3545;
      }
      .actions {
          display: flex;
          gap: 5px;
      }
      .btn-sm {
          padding: 6px 12px;
          font-size: 12px;
      }
      .empty-state {
          text-align: center;
          padding: 40px;
          color: #6c757d;
      }
      .empty-state img {
          width: 100px;
          opacity: 0.5;
          margin-bottom: 20px;
      }
      .chart-container {
          background: white;
          padding: 30px;
          border-radius: 15px;
          box-shadow: 0 4px 20px rgba(0,0,0,0.1);
          margin-bottom: 30px;
          height: 400px;
          position: relative;
      }
      .chart-title {
          text-align: center;
          font-size: 1.3em;
          font-weight: 600;
          color: #2c3e50;
          margin-bottom: 20px;
      }
      .tabs {
          display: flex;
          background: white;
          border-radius: 15px;
          margin-bottom: 30px;
          overflow: hidden;
          box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      }
      .tab {
          flex: 1;
          padding: 20px;
          text-align: center;
          cursor: pointer;
          border: none;
          background: transparent;
          font-weight: 600;
          font-size: 16px;
          transition: all 0.3s ease;
          position: relative;
      }
      .tab.active {
          background: linear-gradient(135deg, #667eea, #764ba2);
          color: white;
      }
      .tab:not(.active):hover {
          background: #f8f9fa;
      }
      .tab-content {
          display: none;
      }
      .tab-content.active {
          display: block;
      }
      .import-section {
          background: #e3f2fd;
          padding: 20px;
          border-radius: 10px;
          margin-bottom: 20px;
      }
      .import-section h4 {
          color: #1976d2;
          margin-top: 0;
      }
      .paste-area {
          width: 100%;
          min-height: 150px;
          padding: 10px;
          border: 2px dashed #90caf9;
          border-radius: 8px;
          font-family: monospace;
          font-size: 12px;
          background: white;
      }
      .paste-area:focus {
          border-color: #1976d2;
          outline: none;
      }
      .help-text {
          font-size: 12px;
          color: #6c757d;
          margin-top: 5px;
      }
      .modal {
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0,0,0,0.5);
          z-index: 1000;
          align-items: center;
          justify-content: center;
      }
      .modal.active {
          display: flex;
      }
      .modal-content {
          background: white;
          padding: 30px;
          border-radius: 15px;
          max-width: 500px;
          width: 90%;
          max-height: 80vh;
          overflow-y: auto;
      }
      .modal-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 20px;
      }
      .modal-header h3 {
          margin: 0;
          color: #2c3e50;
      }
      .close-btn {
          background: none;
          border: none;
          font-size: 24px;
          cursor: pointer;
          color: #6c757d;
      }
      .close-btn:hover {
          color: #2c3e50;
      }
      @media (max-width: 768px) {
          .form-row {
              grid-template-columns: 1fr;
          }
          .stats-grid {
              grid-template-columns: 1fr;
          }
          .btn-group {
              flex-direction: column;
          }
          .table-wrapper {
              max-height: 300px;
          }
      }
  </style>
</head>
<body>
  <div class="container">
      <div class="header">
          <h1>ğŸ’° æ”¶æ”¯ç®¡ç†ç³»çµ±</h1>
          <p>æ‰‹å‹•è¼¸å…¥èˆ‡ç®¡ç†æ‚¨çš„è²¡å‹™æ•¸æ“š</p>
      </div>

      <div class="quick-guide">
          <h3>ğŸ“‹ å¿«é€Ÿä½¿ç”¨æŒ‡å—</h3>
          <ol>
              <li>å¾ Google Sheets è¤‡è£½æ‚¨çš„è³‡æ–™ï¼ˆé¸å–è³‡æ–™ â†’ Ctrl+Cï¼‰</li>
              <li>é»æ“Šã€Œæ‰¹æ¬¡åŒ¯å…¥ã€æŒ‰éˆ•</li>
              <li>å°‡è³‡æ–™è²¼ä¸Šåˆ°æ–‡å­—æ¡†ä¸­ï¼ˆCtrl+Vï¼‰</li>
              <li>é»æ“Šã€ŒåŒ¯å…¥è³‡æ–™ã€å®Œæˆ</li>
              <li>æˆ–è€…ä½¿ç”¨ã€Œæ–°å¢æ”¶å…¥/æ”¯å‡ºã€æ‰‹å‹•è¼¸å…¥å–®ç­†è³‡æ–™</li>
          </ol>
      </div>

      <div class="data-source-links">
          <strong>æ‚¨çš„ Google Sheets é€£çµï¼š</strong>
          <a href="https://docs.google.com/spreadsheets/d/1jpcMCUcpveh7-doxSdHNP6wK5NuxsMvc3-A5Il42Enk/edit?gid=0#gid=0" 
             target="_blank">ğŸ“Š é–‹å•Ÿæ”¶å…¥è¡¨</a>
          <a href="https://docs.google.com/spreadsheets/d/1r8WIQBv41Fz19onWPXcIekwMY-L-BZ36U1amh8LA_2U/edit?gid=0#gid=0" 
             target="_blank">ğŸ“Š é–‹å•Ÿæ”¯å‡ºè¡¨</a>
      </div>

      <div class="stats-grid">
          <div class="stat-card income">
              <h3 id="totalIncome">NT$ 0</h3>
              <p>ğŸ’° ç¸½æ”¶å…¥</p>
          </div>
          <div class="stat-card expense">
              <h3 id="totalExpense">NT$ 0</h3>
              <p>ğŸ’¸ ç¸½æ”¯å‡º</p>
          </div>
          <div class="stat-card balance">
              <h3 id="netBalance">NT$ 0</h3>
              <p>ğŸ’ æ·¨é¤˜é¡</p>
          </div>
          <div class="stat-card">
              <h3 id="totalTransactions">0</h3>
              <p>ğŸ“Š ç¸½äº¤æ˜“æ•¸</p>
          </div>
      </div>

      <div class="tabs">
          <button class="tab active" onclick="switchTab('overview')">ğŸ“Š ç¸½è¦½</button>
          <button class="tab" onclick="switchTab('income')">ğŸ’° æ”¶å…¥ç®¡ç†</button>
          <button class="tab" onclick="switchTab('expense')">ğŸ’¸ æ”¯å‡ºç®¡ç†</button>
          <button class="tab" onclick="switchTab('import')">ğŸ“¥ æ‰¹æ¬¡åŒ¯å…¥</button>
      </div>

      <!-- ç¸½è¦½é é¢ -->
      <div class="tab-content active" id="overview">
          <div class="chart-container">
              <div class="chart-title">ğŸ“Š æ”¶æ”¯å°æ¯”åœ–è¡¨</div>
              <canvas id="overviewChart"></canvas>
          </div>
          
          <div class="data-table">
              <div class="table-header">
                  <h3>ğŸ“‹ æœ€è¿‘äº¤æ˜“è¨˜éŒ„</h3>
              </div>
              <div class="table-wrapper">
                  <table id="recentTransactionsTable">
                      <thead>
                          <tr>
                              <th>æ—¥æœŸ</th>
                              <th>é¡å‹</th>
                              <th>é …ç›®</th>
                              <th>é‡‘é¡</th>
                              <th>å‚™è¨»</th>
                          </tr>
                      </thead>
                      <tbody>
                          <tr>
                              <td colspan="5" class="empty-state">
                                  <p>å°šç„¡äº¤æ˜“è¨˜éŒ„</p>
                              </td>
                          </tr>
                      </tbody>
                  </table>
              </div>
          </div>
      </div>

      <!-- æ”¶å…¥ç®¡ç†é é¢ -->
      <div class="tab-content" id="income">
          <div class="input-section">
              <h2>â• æ–°å¢æ”¶å…¥</h2>
              <form id="incomeForm">
                  <div class="form-row">
                      <div class="form-group">
                          <label>æ—¥æœŸ</label>
                          <input type="date" name="date" required>
                      </div>
                      <div class="form-group">
                          <label>æ”¶å…¥ä¾†æº</label>
                          <input type="text" name="source" placeholder="ä¾‹å¦‚ï¼šå·¥ç¨‹æ¬¾ç¬¬ä¸€æœŸ" required>
                      </div>
                      <div class="form-group">
                          <label>é‡‘é¡</label>
                          <input type="number" name="amount" placeholder="0" min="0" step="0.01" required>
                      </div>
                  </div>
                  <div class="form-group">
                      <label>å‚™è¨»</label>
                      <textarea name="notes" placeholder="é¸å¡«"></textarea>
                  </div>
                  <button type="submit" class="btn btn-success">ğŸ’° æ–°å¢æ”¶å…¥</button>
              </form>
          </div>

          <div class="data-table">
              <div class="table-header">
                  <h3>ğŸ’° æ”¶å…¥æ˜ç´°</h3>
                  <button class="btn btn-primary btn-sm" onclick="exportData('income')">ğŸ“¤ åŒ¯å‡º</button>
              </div>
              <div class="table-wrapper">
                  <table id="incomeTable">
                      <thead>
                          <tr>
                              <th>æ—¥æœŸ</th>
                              <th>æ”¶å…¥ä¾†æº</th>
                              <th>é‡‘é¡</th>
                              <th>å‚™è¨»</th>
                              <th>æ“ä½œ</th>
                          </tr>
                      </thead>
                      <tbody>
                          <tr>
                              <td colspan="5" class="empty-state">
                                  <p>å°šç„¡æ”¶å…¥è¨˜éŒ„</p>
                              </td>
                          </tr>
                      </tbody>
                  </table>
              </div>
          </div>
      </div>

      <!-- æ”¯å‡ºç®¡ç†é é¢ -->
      <div class="tab-content" id="expense">
          <div class="input-section">
              <h2>â• æ–°å¢æ”¯å‡º</h2>
              <form id="expenseForm">
                  <div class="form-row">
                      <div class="form-group">
                          <label>é …æ¬¡</label>
                          <input type="text" name="itemNo" placeholder="ä¾‹å¦‚ï¼š001">
                      </div>
                      <div class="form-group">
                          <label>æ‰¿åŒ…å» å•†</label>
                          <input type="text" name="vendor" placeholder="ä¾‹å¦‚ï¼šå¤§æˆå»ºè¨­" required>
                      </div>
                      <div class="form-group">
                          <label>æ‰¿ä½œé …ç›®</label>
                          <input type="text" name="item" placeholder="ä¾‹å¦‚ï¼šåŸºç¤å·¥ç¨‹" required>
                      </div>
                  </div>
                  <div class="form-row">
                      <div class="form-group">
                          <label>ç™¼ç¥¨é‡‘é¡</label>
                          <input type="number" name="amount" placeholder="0" min="0" step="0.01" required>
                      </div>
                      <div class="form-group">
                          <label>å‚™è¨»</label>
                          <input type="text" name="notes" placeholder="é¸å¡«">
                      </div>
                  </div>
                  <button type="submit" class="btn btn-danger">ğŸ’¸ æ–°å¢æ”¯å‡º</button>
              </form>
          </div>

          <div class="data-table">
              <div class="table-header">
                  <h3>ğŸ’¸ æ”¯å‡ºæ˜ç´°</h3>
                  <button class="btn btn-primary btn-sm" onclick="exportData('expense')">ğŸ“¤ åŒ¯å‡º</button>
              </div>
              <div class="table-wrapper">
                  <table id="expenseTable">
                      <thead>
                          <tr>
                              <th>é …æ¬¡</th>
                              <th>æ‰¿åŒ…å» å•†</th>
                              <th>æ‰¿ä½œé …ç›®</th>
                              <th>ç™¼ç¥¨é‡‘é¡</th>
                              <th>å‚™è¨»</th>
                              <th>æ“ä½œ</th>
                          </tr>
                      </thead>
                      <tbody>
                          <tr>
                              <td colspan="6" class="empty-state">
                                  <p>å°šç„¡æ”¯å‡ºè¨˜éŒ„</p>
                              </td>
                          </tr>
                      </tbody>
                  </table>
              </div>
          </div>
      </div>

      <!-- æ‰¹æ¬¡åŒ¯å…¥é é¢ -->
      <div class="tab-content" id="import">
          <div class="import-section">
              <h4>ğŸ“¥ æ‰¹æ¬¡åŒ¯å…¥æ”¶å…¥è³‡æ–™</h4>
              <p class="help-text">å¾ Google Sheets è¤‡è£½è³‡æ–™ï¼Œç›´æ¥è²¼ä¸Šå³å¯ï¼ˆåŒ…å«æ¨™é¡Œåˆ—ï¼‰</p>
              <textarea class="paste-area" id="incomeImportArea" 
                  placeholder="è²¼ä¸Šæ ¼å¼ç¯„ä¾‹ï¼š
æ—¥æœŸ	æ”¶å…¥ä¾†æº	é‡‘é¡	å‚™è¨»
2024-01-15	å·¥ç¨‹æ¬¾ç¬¬ä¸€æœŸ	50000000	åˆç´„æ¬¾é …
2024-02-20	æ”¿åºœè£œåŠ©	10000000	æ™ºæ…§å»ºç¯‰è£œåŠ©"></textarea>
              <div class="btn-group">
                  <button class="btn btn-success" onclick="importIncomeData()">åŒ¯å…¥æ”¶å…¥è³‡æ–™</button>
                  <button class="btn btn-secondary" onclick="clearImportArea('income')">æ¸…é™¤</button>
              </div>
          </div>

          <div class="import-section">
              <h4>ğŸ“¥ æ‰¹æ¬¡åŒ¯å…¥æ”¯å‡ºè³‡æ–™</h4>
              <p class="help-text">å¾ Google Sheets è¤‡è£½è³‡æ–™ï¼Œç›´æ¥è²¼ä¸Šå³å¯ï¼ˆåŒ…å«æ¨™é¡Œåˆ—ï¼‰</p>
              <textarea class="paste-area" id="expenseImportArea" 
                  placeholder="è²¼ä¸Šæ ¼å¼ç¯„ä¾‹ï¼š
é …æ¬¡	æ‰¿åŒ…å» å•†	æ‰¿ä½œé …ç›®	ç™¼ç¥¨é‡‘é¡	å‚™è¨»
001	å¤§æˆå»ºè¨­	åŸºç¤å·¥ç¨‹	15000000	åœ°åŸºé–‹æŒ–
002	ä¸­è¯å·¥ç¨‹	çµæ§‹å·¥ç¨‹	25000000	é‹¼ç­‹æ··å‡åœŸ"></textarea>
              <div class="btn-group">
                  <button class="btn btn-danger" onclick="importExpenseData()">åŒ¯å…¥æ”¯å‡ºè³‡æ–™</button>
                  <button class="btn btn-secondary" onclick="clearImportArea('expense')">æ¸…é™¤</button>
              </div>
          </div>

          <div class="import-section" style="background: #fff3cd;">
              <h4>âš ï¸ æ³¨æ„äº‹é …</h4>
              <ul>
                  <li>è«‹ç¢ºä¿å¾ Google Sheets è¤‡è£½æ™‚åŒ…å«æ¨™é¡Œåˆ—</li>
                  <li>é‡‘é¡æ¬„ä½æœƒè‡ªå‹•å»é™¤é€—è™Ÿå’Œè²¨å¹£ç¬¦è™Ÿ</li>
                  <li>æ—¥æœŸæ ¼å¼å»ºè­°ä½¿ç”¨ YYYY-MM-DD</li>
                  <li>åŒ¯å…¥å‰è«‹å…ˆå‚™ä»½æ‚¨çš„è³‡æ–™</li>
              </ul>
          </div>
      </div>
  </div>

  <!-- ç·¨è¼¯æ¨¡æ…‹æ¡† -->
  <div class="modal" id="editModal">
      <div class="modal-content">
          <div class="modal-header">
              <h3 id="modalTitle">ç·¨è¼¯é …ç›®</h3>
              <button class="close-btn" onclick="closeModal()">&times;</button>
          </div>
          <form id="editForm">
              <div id="modalFormContent">
                  <!-- å‹•æ…‹ç”Ÿæˆè¡¨å–®å…§å®¹ -->
              </div>
              <div class="btn-group">
                  <button type="submit" class="btn btn-primary">å„²å­˜è®Šæ›´</button>
                  <button type="button" class="btn btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>
              </div>
          </form>
      </div>
  </div>

  <script>
      // è³‡æ–™å„²å­˜
      let incomeData = [];
      let expenseData = [];
      let chart = null;

      // åˆå§‹åŒ–
      document.addEventListener('DOMContentLoaded', function() {
          loadDataFromLocalStorage();
          updateStatistics();
          updateAllTables();
          initChart();
          
          // è¨­å®šä»Šå¤©æ—¥æœŸç‚ºé è¨­å€¼
          const dateInputs = document.querySelectorAll('input[type="date"]');
          const today = new Date().toISOString().split('T')[0];
          dateInputs.forEach(input => input.value = today);
      });

      // å¾ LocalStorage è¼‰å…¥è³‡æ–™
      function loadDataFromLocalStorage() {
          const savedIncome = localStorage.getItem('incomeData');
          const savedExpense = localStorage.getItem('expenseData');
          
          if (savedIncome) incomeData = JSON.parse(savedIncome);
          if (savedExpense) expenseData = JSON.parse(savedExpense);
      }

      // å„²å­˜è³‡æ–™åˆ° LocalStorage
      function saveDataToLocalStorage() {
          localStorage.setItem('incomeData', JSON.stringify(incomeData));
          localStorage.setItem('expenseData', JSON.stringify(expenseData));
      }

      // åˆ‡æ›åˆ†é 
      function switchTab(tabName) {
          // æ›´æ–°åˆ†é æŒ‰éˆ•
          document.querySelectorAll('.tab').forEach(tab => {
              tab.classList.remove('active');
          });
          event.target.classList.add('active');
          
          // æ›´æ–°åˆ†é å…§å®¹
          document.querySelectorAll('.tab-content').forEach(content => {
              content.classList.remove('active');
          });
          document.getElementById(tabName).classList.add('active');
          
          // æ›´æ–°åœ–è¡¨
          if (tabName === 'overview') {
              updateChart();
          }
      }

      // æ–°å¢æ”¶å…¥
      document.getElementById('incomeForm').addEventListener('submit', function(e) {
          e.preventDefault();
          
          const formData = new FormData(e.target);
          const income = {
              id: Date.now(),
              date: formData.get('date'),
              source: formData.get('source'),
              amount: parseFloat(formData.get('amount')),
              notes: formData.get('notes') || ''
          };
          
          incomeData.push(income);
          saveDataToLocalStorage();
          updateStatistics();
          updateAllTables();
          updateChart();
          
          e.target.reset();
          const today = new Date().toISOString().split('T')[0];
          e.target.querySelector('input[type="date"]').value = today;
          
          alert('æ”¶å…¥å·²æˆåŠŸæ–°å¢ï¼');
      });

      // æ–°å¢æ”¯å‡º
      document.getElementById('expenseForm').addEventListener('submit', function(e) {
          e.preventDefault();
          
          const formData = new FormData(e.target);
          const expense = {
              id: Date.now(),
              itemNo: formData.get('itemNo') || '',
              vendor: formData.get('vendor'),
              item: formData.get('item'),
              amount: parseFloat(formData.get('amount')),
              notes: formData.get('notes') || ''
          };
          
          expenseData.push(expense);
          saveDataToLocalStorage();
          updateStatistics();
          updateAllTables();
          updateChart();
          
          e.target.reset();
          
          alert('æ”¯å‡ºå·²æˆåŠŸæ–°å¢ï¼');
      });

      // æ‰¹æ¬¡åŒ¯å…¥æ”¶å…¥è³‡æ–™
      function importIncomeData() {
          const data = document.getElementById('incomeImportArea').value.trim();
          if (!data) {
              alert('è«‹å…ˆè²¼ä¸Šè³‡æ–™ï¼');
              return;
          }
          
          try {
              const lines = data.split('\n');
              const headers = lines[0].split('\t');
              
              for (let i = 1; i < lines.length; i++) {
                  const values = lines[i].split('\t');
                  if (values.length >= 3) {
                      const income = {
                          id: Date.now() + i,
                          date: values[0] || new Date().toISOString().split('T')[0],
                          source: values[1] || '',
                          amount: parseFloat(values[2].replace(/[^0-9.-]/g, '')) || 0,
                          notes: values[3] || ''
                      };
                      incomeData.push(income);
                  }
              }
              
              saveDataToLocalStorage();
              updateStatistics();
              updateAllTables();
              updateChart();
              
              document.getElementById('incomeImportArea').value = '';
              alert(`æˆåŠŸåŒ¯å…¥ ${lines.length - 1} ç­†æ”¶å…¥è³‡æ–™ï¼`);
          } catch (error) {
              alert('åŒ¯å…¥å¤±æ•—
